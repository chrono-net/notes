# 2019/4月ssmjp参加記録  #ssmjp 2019/04 #2  
時間：2019/4/18 19:30-21:30  
会場： インフォセックさん  
  
※会場でとってたメモです、間違っている可能性がありますのでご容赦ください    

## 前説　19:30-19:40 	@tigerszkさん 	前枠/会場諸注意  
ssmjpはインフラ運用がメインです。  
今回は珍しく（？）運用ネタが多めです。  
会場募集中です。  
アウトプットしないのは知的な便秘←JAWSDAYSで紹介されました！  
今回は通常会です、次回DNS会はスペシャル会です。  
LTの練習場としても参加されてます。  
  
---  
## １．19:40-20:00 	ありすゆうさん 	メールサーバがクラッシュした日(コミケ前日)の話  
ベアメタルサーバ時代のお話です  
メールサーバをオンプレ運用していた  
全ユーザに対して送信先をホワイトリスト管理  
なぜか一人情シス状態でその担当に  
プライマリ、セカンダリの構成セカンダリにきたのはプライマリに  
MTAはpostfix RTAはCourier-iMAP  
OepnLDAP,SquirrelMail,etc 使用していた    
それらを残ってる機材でこっそり運用しようとしていた  
外部サービスは諸事情で使えず  
2010年8月某日16時ごろプライマリサーバが音信不通  
ファイルシステムがクラッシュしていた  
部署ローカルのはずが工場にも採用されていた  
明日コミケにどうしてもいきたい、あと16時間、徹夜覚悟  
LDAP,プライマリ構成は残っていた、セカンダリは生き残っていた  
構築手順と理屈を自分用wikiに残していた  
配信済みメールデータバックアップはなし  
セカンダリMXをプライマリに転用  
セカンダリは他のPCにしようとしたが、デスクトップしかなかった  
そのPCにCentOSとPostfixインストールしてセカンダリMXに設定  
DCへ持っていった、徹夜組対策の警備員さんにつれて  
新しいセカンダリMXを第三のDNSエントリに設定した  
既存のさーばの変更は避けたかったため  
新セカンダリへ滞留メールを新セカンダリにフラッシュした  
コンポーネントを旧セカンダリMXにインストール  
Courier-IMAPはソースからビルドしたので時間がかかった  
コミケまであと10時間前（当日突入）  
プライマリ以下のetc以下をバックアップしていた  
/usr/lib/Courier/etc以下ものこっていた  
ユーザアカウントDBを復旧  
ホームディレクトリの再生→メールボックスごとにホームディレクトリ  
LDIFからホームディレクトリを再生  
IPアドレスを追加
旧セカンダリMXにプライマリMXのIPアドレスを追加  
設定のすりあわせ  
新しいプライマリMXのテスト  
新セカンダリをいったん停止してから新プライマリMXをテスト  
あと4時間  
経過観察は必要だがとりあえず復旧  
徹夜のテンション  
後始末  
ログで確認  
ユーザ側で確認してもらった  
開上から3時間経過  
いまオンプレでやるならAnsibleにしておく  
運用チーム最低3人はほしい  
設定のバックアップとユーザアカウントのバックアップ必要  
構築作業の記録があるといい→Ansible  
オンプレでMTA動かしたいならリスクとサービスそのものをバックアップしよう  
  
Q:旧セカンダリからフラッシュした理由は  
A:滞留メールの配信エラーが一気に発生する可能性があったため  
  
  
---  
## 2．20:00-20:30 	khiroseさん 	技術書典6に参加しました。他  
技術書展６参加レポート  
4/14 池袋サンシャインホール２F  
ssmjpのslackで始まった企画  
公式ではないので同人部  
2017/4～技術書展2,5,6で出しました  
はじめ9名9記事40ページで1000円  
つぎは5名で6記事,Re:View2を使ってみた  
反省からRe:View3で、7名8記事　５６ぺーじ  
1月：書く人募集、2月なし、3月進捗確認開始、3月中旬表紙完成お手製CIでPDF作成  
3月下旬合宿このときにほとんど書いた、印刷所20パーセント引き間に合うか？  
サークル紹介カードをつくった  
4月2日１０パーセントびきあきらめる  
8日に全員の原稿がそろう、ページ数調整  
9日全員入稿、印刷所から指摘が着たので調整して再入稿  
10日にDL用データ作成、登録  
技術書展６からかんたん後払いができるようになったので、電子版を用意した  
ささみのほん３を200部持ち込んだ  
５２ぺーじ￥４６,８００、５６ページ￥４８,８００、６０ページ￥５２,２００、６４ページ￥５４,２００  
とページ数で差額がある、当初５８ページだったが３４００円安くするために空白とか調整しまくった  
アウトプットしないのは～がささった、のぼりも立てた効果あった（と思う）  
名詞は配りきりました  
新刊65部既刊21部目標はクリア  
前回よかったから  
女性が少なかった、10名くらいはいたが8割知人だった？  
既刊だけ買っていくかたもいた  
何の本ですか？→回答に困った  
表紙裏表紙問題→萌え絵が買いにくかったとの声があった  
反省・改善  
Re:View　レイアウト職人、Tex職人（で調整）、最後はAcrobat職人の手作業も、職人化はよくない  
popにはコンセプトや内容の確認を  
買わなかった人からのフィードバック重要  
ないしょ：名詞渡してssmjpによく行く方もいたけどかってもらえなかったこともあって。。。  
直前のドタバタは変わらない  
執筆環境（Re:View＋CI）を常時使えるように  
チケットによるプロジェクト管理  
役割分担・コミュニケーションの整理  
なんの本ですか質問対策  
カードの効果は？  
googleフォームで感想  
直前のドタバタは変わらないがよくなっている  
執筆者が多いと調整大変  
編集担当はいたほうがいい  
合宿などで効率よく  
圧倒的な締め切り駆動→常に締め切りくる  
定常的なDL  
技術書展毎に新刊を  
  
Q:のぼりの内容は目次ではだめだった？  
A:よくわからなくなってしまってやめました。→技術書展の公式ページには目次入れました。  
  
20:30-20:40 	休憩  
  
---  
## 20:40-20:50 	株式会社インフォセック様 	ご案内  
情報セキュリティ→インフォセックに  
マネジメント、テクノロジー、セキュリティソリューションやってます  
InfoCICマネージドセキュリティサービス  
問題なし＞注意＞警戒＞重大  
Follow-The-Sun：欧州ー日本ー米国で昼間のみで運用できるようにしてます  
アナリストが少ないので募集してます（切実）  
  
---  
## 3．20:50-21:10 	@Typhon666_deathさん  
ウォーターフォールとアジャイルにおける組織内リリース承認フローの考え方について相談  
WFですかアジャイルですか  
  
アジャイルとITILが両立できますか？  
  
リリース判定について  
レビューア兼部内品質管理ちーむなう  
あじゃいる開発している  
サービスやアプリ、モジュールなど本番作業の前に行われるはずのリリース判定について疑問に  
おもうことが  
  
リリース判定は  
リリース管理プロセス展開管理プロセスがある  
ウォータフォールにおけるレビュー  
用件定義、設計、開発、テストそれぞれレビュー  
アジャイルにおけるレビュー  
コードのレビューはするが本番リリース作業におけるレビューはほぼしない  
カナリアリリースで問題発覚したらすぐにもどし作業  
スプリント毎にレビューを実施  
それぞれにおける品質の違い  
ウォーターフォールではバグは出せない  
アジャイルはバグは含んでいてもいい（重大でなければ）変化への対応が優先  
こんな両極端な開発プロジェクトをやっているチームにおいてあるべきリリース判定会議やレビューは  
どうあるべきなのか  
なんとなく浮かんだアイデア  
ウォータフォール、アジャイル、会社から求めらるもの、  
バグ件数、前提、枠組み、重要視、対顧客  
アジャイル環境の開発パイプライン  
commitからdeployまで自動化してて一通  
アプリケーション開発はアジャイルだが、  
開発したものを導入を追加  
リリース判定の範囲  
担当しない範囲  
プロダクトオーナが見ているもの  
ただし納品するなかで例外もある  
アジャイルとITILの親和性  
日々のOpsとは少し違う観点ではあるけどレビューのありかたも運用設計して必要ではないか  
  
コメント：海外の人に運用でカバーはありえない、DCで手順書まで作りこむので  
Q:ユーザがお客さん社内で使うレベルのものですか？  
A:社内向け  
  
---  
## 4．21:10-21:50 	@tcshさん 	「運用自動化の基本原則」その1  
[2019-04-18 「運用自動化」に対する幻想 /operation-automation-illusion](https://speakerdeck.com/opelab/operation-automation-illusion)  
40分で60枚あります  
IW2018で登壇しました　5月31日に仙台で再演します  
みんな大好き運用自動化  
自動化大好きtcshさん目指します  
完成された理論ではありません  
基本原則１～３あるうちのっ今回１です  
toil減らすのは立派な自動化だと思う、について  
toilを減らすことでユーザが求めるサービスを作る時間が生まれる  
星のつかない肯定的なコメントは壮年期なかたっぽい  
星のつく否定的なコメント少数  
  
運用業務をコードレベルまで定数化し  
設計なき実装に陥りバグを生みやすい  
事業継続性の向上するか  
サービス価値向上に貢献するか  
デリバリ価値向上に貢献するか  
  
ビジネスの継続に貢献する必要がある  
定常業務の継続に貢献する必要がある  
  
運用自動化あるある  
自動化すれば工数が減ります、ミスがなくなりますっていませんか？  
工数削減の幻想について  
想像力のないエンジニアがやると大変   
実装者が移動や転勤でいなくなるとメンバーではわからなくなることがある  
後任者はリバースエンジニアリングしないといけない場合がある  
単価の高い人が工数かけて、単価の低い人の工数減らすのは赤になることがおおい  
後任者がまたいなくなるとつぎの後任者がさらに大変  
ミス撲滅の幻想  
自動化実装者が異動でいなくなったあと、後任者が仕様をリバースエンジニアリングする  
プログラムは書かれたとおりに動くので仕様バグもそのままになる  
説明できない、事故がおきることが発生  
引継ぎの原則  
設計実装内容を設計実装者以外にひきつぐことが前提  
運用自動化で最も大事な原則  
continuation/continuity/take over  
引きつぎ前提のない自動化は  
インプットアウトプット品質が低い  
ヒアリング適当、仕様も適当、レビューがなし  
引継ぎしないのでだれも困らない（ように見える）  
  
実装が適当  
リファクタリングしない  
ドキュメント作らない  
  
引継ぎしないので誰も困らない  
数年後潜在化問題が頻発して顕在化する  
自動化の波及効果  
環境の変化に追随できない  
業務の見えないかが進む  
ひとを育てる効果がない  
自動化は硬直化  
  
この２つが割りと困ったパターン  
なんとなく自動化パターン  
プロトタイプ書いてそのままうごいた  
  
やってあげるよ自動化パターン  
口頭ヒアリングで実装しひきわたしご放置  
  
引継ぎのある自動化のばあい  
体制と予算がしっかりしてくる  
ロードマップも引きやすくなる  
ひとを育てる効果がある  
  
適切な運動自動化を実現するには生態系を運用現場で確立する必要がある  
基本原則その１の２へ続く。。。  
  
まとめ  
引継ぎの原則１：  
設計実装内容を設計実装者以外にひきつぐことが前提  
  
・工数減ります  
単価の低いひとの工数を下げるために単価の高い人の工数を奪う  
・ミスがなくなります  
致命的な問題も継続的安定的に提供する  
  
Q:もし不幸にして後任者になったら  
A:徹夜を覚悟するところから、知ってるひとを捕まえる、断片てきな情報から外枠を埋める  
極力リバースエンジニアリングしないようにする  
Q:Cのプログラムはどうなったのか  
A:リバースエンジアリングできなかったらしいです?  
  
---  
## 所感  
メールサーバ運用LT、自分の予定と業務都合を両立せざるをえない場合あるあるな状況でした。    
(通常メールサーバであればBCPで多重ｋ・・・(げふんげふん))  
次の日に自分の行きたいイベントがある中での障害対応はやっぱり避けたいですね。。。  
今回はそうした中でどうやって対応したのか、貴重な体験談を聞くことができたと思ってます。  
  
技術書典6出展者側での参加お疲れ様でした。  
ささみのほん３は無事にＧＥＴしました。  
裏話を聞くといろいろと苦労があったんですね。。。
締め切りが迫ってる中、それでも印刷物(物理)の寸法を測って調整したというのは、  
なかなか通常ないのではないかな、と。  
~~薄い本~~出版物を作成したことはありませんが、やっぱり大変そうだなあ、と思いました。
  
開発現場の運用の話、従来型のウォーターフォール、柔軟なアジャイルとよく聞きますが、  
プロダクトの性質に分類されるのかな、と思ってます。  
ウォーターフォールはそれぞれの工程をきっちり終わらせるため、バグの許されないアプリケーション向け、  
アジャイルはある程度のバグの許される(運用でカバーできる)アプリケーション向け、といった具合に。  
質疑応答から感じたのは24/265で動かさなくてもいいのであれば、アジャイル向けなのかな、と。  
ただし、インターネットに出す場合であれば、脆弱性を出さないように注意しないといけないので、  
アジャイルの場合、そのギャップをどうやっているのかは気になるところだと思います。  
(デバッグ、脆弱性対応のスプリントを作ってで対応している？？)  
  
![全回の内容](https://speakerdeck.com/opelab/operation-automation-3-bad-model)のその１を
もう少し掘り下げた内容でした。既に稼働しているシステムの保守で改造しようとしたとき、  
ドキュメントが残っていないとホントにつらいので、なにを、どうして、どうやって、が残っていると  
助かるなあ、と思うことがあります。ただ、実装された前任者が事業継続性に貢献するか？までは  
意識できないことは~~多々~~あるので、これを無くすためにもこの視点を意識して取り組めるといいなあ、  
と思いました。  

<会場風景>  
  
![result](https://github.com/chrono-net/media/blob/20180830/20190418-1.jpg)  
![result](https://github.com/chrono-net/media/blob/20180830/20190418-2.jpg) 
